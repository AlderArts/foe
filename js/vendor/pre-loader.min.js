(function(){"use strict";function t(t,e){var o=[],r=this.options;return r.onProgress&&t&&r.onProgress.call(this,t,e,this.completed.length),this.completed.length+this.errors.length===this.queue.length&&(o.push(this.completed),this.errors.length&&o.push(this.errors),r.onComplete.apply(this,o)),this}var e="addEventListener"in new Image,o=function(t,e){this.options={pipeline:!1,auto:!0,prefetch:!1,onComplete:function(){}},e&&"object"==typeof e&&this.setOptions(e),this.addQueue(t),this.queue.length&&this.options.auto&&this.processQueue()};o.prototype.setOptions=function(t){var e,o=this.options;for(e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);return this},o.prototype.addQueue=function(t){return this.queue=t.slice(),this},o.prototype.reset=function(){return this.completed=[],this.errors=[],this},o.prototype._addEvents=function(o,r,n){var s=this,i=this.options,h=function(){e?(this.removeEventListener("error",u),this.removeEventListener("abort",u),this.removeEventListener("load",l)):this.onerror=this.onabort=this.onload=null},u=function(){h.call(this),s.errors.push(r),i.onError&&i.onError.call(s,r),t.call(s,r),i.pipeline&&s._loadNext(n)},l=function(){h.call(this),s.completed.push(r),t.call(s,r,this),i.pipeline&&s._loadNext(n)};return e?(o.addEventListener("error",u,!1),o.addEventListener("abort",u,!1),o.addEventListener("load",l,!1)):(o.onerror=o.onabort=u,o.onload=l),this},o.prototype._load=function(t,e){var o=new Image;return this._addEvents(o,t,e),o.src=t,this},o.prototype._loadNext=function(t){return t++,this.queue[t]&&this._load(this.queue[t],t),this},o.prototype.processQueue=function(){var t=0,e=this.queue,o=e.length;if(this.reset(),this.options.pipeline)this._load(e[0],0);else for(;o>t;++t)this._load(e[t],t);return this},o.lazyLoad=function(t){t||(t={});for(var e,r=document.querySelectorAll(t.selector||"img[data-preload]"),n=0,s=r.length,i=[];s>n;n++)i.push(r[n].getAttribute("data-preload"));return t.onProgress&&(e=t.onProgress),t.onProgress=function(t,o,n){r[n-1].src=t,r[n-1].removeAttribute("data-preload"),e&&e.apply(this,arguments)},i.length?new o(i,t):null},"function"==typeof define&&define.amd?define(function(){return o}):this.preLoader=o}).call(this);